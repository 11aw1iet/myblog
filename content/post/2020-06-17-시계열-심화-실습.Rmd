---
title: 시계열 심화 실습
author: 이현탁
date: '2020-05-19'
slug: 시계열-심화-실습
categories:
  - R
tags:
  - R Markdown
---

# 1. BOX-COX 람다추정
```
install.packages("MASS")
library(MASS)



 x <- rexp(1000) # 지수분포로부터 난수 발생
 x
 par(mfrow=c(1,2))
 hist(x)
 qqnorm(x) # 정규확률그림


 par(mfrow=c(1,1))
 boxcox(x~1) # 로그-가능도 프로파일


install.packages("car")
library(car)

 p <- powerTransform(x) # 박스-콕스 변환의 람다 추정
p

 y <- bcPower(x, p$lambda) # 박스-콕스 변환
y
 par(mfrow=c(1,2))
 hist(y)
 qqnorm(y) # 변환된 자료의 정규확률그림
``` 
 
 
 
 
# 2. VAR모형분석
```
set.seed(123) # Reset random number generator for reasons of reproducability
```
## Generate sample
```
t <- 200 # Number of time series observations
k <- 2 # Number of endogenous variables
p <- 2 # Number of lags
```
## Generate coefficient matrices
```
A.1 <- matrix(c(-.3, .6, -.4, .5), k) # Coefficient matrix of lag 1
A.2 <- matrix(c(-.1, -.2, .1, .05), k) # Coefficient matrix of lag 2
A <- cbind(A.1, A.2) # Companion form of the coefficient matrices
```
## Generate series
```
series <- matrix(0, k, t + 2*p) # Raw series with zeros
for (i in (p + 1):(t + 2*p)){ # Generate series with e ~ N(0,0.5)
  series[, i] <- A.1%*%series[, i-1] + A.2%*%series[, i-2] + rnorm(k, 0, .5)
}


head(series)
plot.ts(series) # Plot the series
```
## 인과성 검정을 위한 패키지 설치
```
install.packages("lmtest")
library(lmtest)
grangertest(series[,1]~series[,2], order=2,data=series) #인과성 검정
grangertest(series[,2]~series[,1], order=2,data=series) #인과성 검정

install.packages("vars")
library(vars) # Load package
```
## var모형 사용법
```
VAR(y, p = 1, type = c("const", "trend", "both", "none"),
    season = NULL, exogen = NULL, lag.max = NULL,
    ic = c("AIC", "HQ", "SC", "FPE"))


VARselect(series) # p=2를 추천 #자동으로 최적의 p구해줌 

var.1 <- VAR(series, p=2, type = "none")  # Estimate the model #var(P)의 p 결정을 위해 AIC는 시차값을 크게선택하는 경향있으니 HQ나 BIC 추천함
var.1
summary(var.1)
```


# + 추정된계수 한눈에보게 모을때
## 1)Extract coefficients, standard errors etc. from the object
## 2)produced by the VAR function
```
est_coefs <- coef(var.1)
```
## 3)Extract only the coefficients for both dependend variables and combine them to a single matrix
```
est_coefs <- rbind(est_coefs[[1]][, 1], est_coefs[[2]][, 1]) 
```
## 4)Print the rounded estimates in the console
```
round(est_coefs, 2)
```


# 3.예측
```
predict(var.1, n.ahead=10, ci=0.95)
```
## forecast함수 쓰고싶을땐
```
install.packages("forecast")
library(forecast)
forecast(var.1) 
```

## Calculate the IRF충격반응함수보기
```
ir.1 <- irf(var.1, impulse = "Series.1", response = "Series.2", n.ahead = 20, ortho = FALSE)
```
## Plot the IRF
```
plot(ir.1)
```











# 4. r참고논문속의 예제
```
install.packages("vars")
library(vars) # Load package

data(Canada)
summary(Canada)
```
## 시도표
```
plot.ts(Canada) 
```
## 단위근검정시행
```
adf1 <- summary(ur.df(Canada[, "prod"], type = "trend", lags = 2)) #비정상추세있음
adf1 
```
## 변수들이 차분 1이 필요
```

VARselect(Canada, lag.max = 8, type = "both") #시차 2가 가장 큰작은 값을 가짐 
```
## 결과를 보면 각자 다른 차수를 추천
```
$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
3      2      1      3 
```

## sc가 추천해준 시차 1
```
Canada <- Canada[, c("prod", "e", "U", "rw")]
p1ct <- VAR(Canada, p = 1, type = "both")
p1ct
summary(p1ct, equation = "e") #e 시계열만  보여줌
plot(p1ct, names = "e")

ser11 <- serial.test(p1ct, lags.pt = 16, type = "PT.asymptotic") #포트만토검정
ser11$serial



var.2c <- VAR(Canada, p = 2, type = "const")
predict(var.2c, n.ahead = 8, ci = 0.95)
```